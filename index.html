<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Ensino - CPP II Bauru</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --verde: #2d9344; --laranja: #e67e22; --azul: #3498db; --roxo: #8b5cf6;
            --vermelho: #d32f2f; --cinza-claro: #f4f7f6; --dark: #2c3e50;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--cinza-claro); display: flex; flex-direction: column; align-items: center; min-height: 100vh; }

        #main-header { text-align: center; padding: 20px 10px; }
        .logo-placeholder { font-size: 3rem; margin-bottom: 5px; display: block; }
        h2 { color: var(--dark); font-size: 1.8rem; text-transform: uppercase; }
        .subtitle { color: #666; font-size: 0.9rem; font-weight: 500; }

        #main-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; width: 95%; max-width: 900px; margin-top: 10px; }
        .card-btn { height: 130px; border: none; border-radius: 12px; color: white; font-weight: bold; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.3s; }
        .card-btn i { font-size: 2rem; margin-bottom: 10px; }
        .card-btn:hover { transform: translateY(-3px); filter: brightness(1.1); }

        .btn-verde { background: var(--verde); }
        .btn-laranja { background: var(--laranja); }
        .btn-azul { background: var(--azul); }
        .btn-roxo { background: var(--roxo); }

        .content-card { width: 98%; max-width: 1350px; background: white; border-radius: 12px; padding: 20px; display: none; box-shadow: 0 8px 20px rgba(0,0,0,0.1); margin-top: 15px; margin-bottom: 30px; }
        .active { display: flex; flex-direction: column; }
        .btn-voltar { background: #666; color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; margin-bottom: 15px; align-self: flex-start; }

        .form-row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: flex-end; }
        label { display: block; font-size: 0.72rem; font-weight: bold; margin-bottom: 4px; color: var(--dark); }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.82rem; }
        
        .btn-std { padding: 10px 15px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; font-size: 0.85rem; }
        .table-wrapper { width: 100%; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; }
        thead th { position: sticky; top: 0; background: #f8f9fa; padding: 12px; border-bottom: 2px solid #dee2e6; font-size: 0.75rem; }
        tbody td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; font-size: 0.82rem; }

        #modalGeral, #modalGestaoAlunos { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 400px; max-height: 90vh; overflow-y: auto; }
        
        #loading { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:5000; justify-content:center; align-items:center; flex-direction:column; }
        .badge-conc { background: var(--vermelho); color: white; font-size: 0.6rem; padding: 2px 4px; border-radius: 3px; margin-left: 4px; }
    </style>
</head>
<body>

    <div id="loading"><i class="fa fa-spinner fa-spin fa-2x"></i><p>PROCESSANDO...</p></div>

    <div id="main-header">
        <span class="logo-placeholder">üéì</span>
        <h2>Gest√£o de Ensino</h2>
        <div class="subtitle">CPP II "Dr. Eduardo de Oliveira Vianna" de Bauru</div>
    </div>

    <div id="main-menu">
        <button class="card-btn btn-verde" onclick="abrir('cursos')"><i class="fa fa-book-open"></i>CURSOS</button>
        <button class="card-btn btn-laranja" onclick="abrir('regular')"><i class="fa fa-school"></i>ENSINO REGULAR</button>
        <button class="card-btn btn-azul" onclick="abrir('superior')"><i class="fa fa-graduation-cap"></i>ENSINO SUPERIOR</button>
        <button class="card-btn btn-roxo" onclick="abrir('projetos')"><i class="fa fa-folder-open"></i>PROJETOS / JORNADA</button>
    </div>

    <div id="cursos" class="content-card">
        <button class="btn-voltar" onclick="voltarAoMenu()">Menu</button>
        <h3 style="color:var(--verde); margin-bottom:10px;">Cursos Profissionalizantes / Outros</h3>
        <div class="form-row">
            <div style="flex:2;"><label>CURSO</label><input type="text" id="curNome"></div>
            <div style="width:150px;"><label>TIPO</label><select id="curTipo"><option value="">Selecione...</option><option>Profissionalizante</option><option>PROET</option><option>TELEPORT</option><option>Cultural</option></select></div>
            <div style="width:100px;"><label>CARGA</label><input type="text" id="curCarga"></div>
            <div style="width:140px;"><label>IN√çCIO</label><input type="date" id="curIni"></div>
            <div style="width:80px;"><label>PART.</label><input type="number" id="curPart"></div>
            <button class="btn-std btn-verde" onclick="salvarNovo('cursos')">Salvar</button>
        </div>
        <div class="table-wrapper"><table><thead><tr><th>N¬∫</th><th>CURSO</th><th>TIPO</th><th>CARGA</th><th>IN√çCIO</th><th>T√âRMINO</th><th>PART.</th><th>CONC.</th><th>A√á√ïES</th></tr></thead><tbody id="listaCursos"></tbody></table></div>
    </div>

    <div id="superior" class="content-card">
        <button class="btn-voltar" onclick="voltarAoMenu()">Menu</button>
        <h3 style="color:var(--azul); margin-bottom:10px;">Ensino Superior</h3>
        <div class="form-row">
            <div style="flex:2;"><label>NOME DO CURSO</label><input type="text" id="supNome"></div>
            <div style="width:120px;"><label>GRAU</label><select id="supGrau"><option>Tecn√≥logo</option><option>Gradua√ß√£o</option><option>P√≥s</option><option>Mestrado</option><option>Doutorado</option></select></div>
            <div style="flex:1;"><label>INSTITUI√á√ÉO</label><input type="text" id="supInst"></div>
            <div style="width:110px;"><label>PER√çODO</label><select id="supPer"><option>Matutino</option><option>Vespertino</option><option>Noturno</option></select></div>
            <div style="width:50px;"><label>SL</label><input type="text" id="supSala" maxlength="1"></div>
            <div style="width:60px;"><label>AL</label><input type="number" id="supAlunos"></div>
            <div style="width:140px;"><label>IN√çCIO</label><input type="date" id="supIni"></div>
            <button class="btn-std btn-azul" onclick="salvarNovo('superior')">Salvar</button>
        </div>
        <div class="table-wrapper"><table><thead><tr><th>N¬∫</th><th>CURSO</th><th>GRAU</th><th>INSTITUI√á√ÉO</th><th>PER.</th><th>SL</th><th>AL</th><th>IN√çCIO</th><th>T√âRMINO</th><th>A√á√ïES</th></tr></thead><tbody id="listaSuperior"></tbody></table></div>
    </div>

    <div id="regular" class="content-card">
        <button class="btn-voltar" onclick="voltarAoMenu()">Menu</button>
        <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:15px;">
            <h3 style="color:var(--laranja);">Ensino Regular - Salas</h3>
            <button class="btn-std" style="background:var(--dark);" onclick="abrirGestaoAlunos()"><i class="fa fa-users"></i> Gest√£o de Alunos</button>
        </div>
        <div class="form-row">
            <div style="flex:2;"><label>GRADE (NOME DA SALA)</label><input type="text" id="regGrade"></div>
            <div style="width:150px;"><label>TIPO</label><select id="regTipo"><option>Alfabetiza√ß√£o</option><option>Fundamental Final</option><option>Ensino M√©dio</option></select></div>
            <div style="width:120px;"><label>PER√çODO</label><select id="regPer"><option>Matutino</option><option>Vespertino</option><option>Noturno</option></select></div>
            <div style="width:80px;"><label>SEM.</label><select id="regSem"><option>1¬∫</option><option>2¬∫</option></select></div>
            <div style="width:50px;"><label>SL</label><input type="text" id="regSala" maxlength="1"></div>
            <div style="width:130px;"><label>IN√çCIO</label><input type="date" id="regIni"></div>
            <div style="width:130px;"><label>T√âRMINO</label><input type="date" id="regFim"></div>
            <button class="btn-std btn-laranja" onclick="salvarNovo('regular')">Salvar</button>
        </div>
        <div class="table-wrapper"><table><thead><tr><th>GRADE</th><th>TIPO</th><th>PER.</th><th>SEM.</th><th>SL</th><th>TOTAL</th><th>MATR.</th><th>EXCL.</th><th>A√á√ïES</th></tr></thead><tbody id="listaSalas"></tbody></table></div>
    </div>

    <div id="modalGeral"><div class="modal-content"><h4 id="mTit"></h4><input type="hidden" id="mIdx"><input type="hidden" id="mTipo"><div id="mCampos"></div><div style="display:flex; gap:10px; margin-top:15px;"><button class="btn-std btn-verde" style="flex:1" onclick="confirmarEdicao()">Confirmar</button><button class="btn-std" style="flex:1; background:#666" onclick="fecharModal()">Sair</button></div></div></div>

    <div id="modalGestaoAlunos">
        <div class="modal-content" style="width:95%; max-width:1000px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:2px solid var(--dark); padding-bottom:10px;">
                <h3>Gest√£o de Alunos</h3>
                <button class="btn-std" style="background:var(--vermelho)" onclick="fecharGestaoAlunos()">Fechar</button>
            </div>
            <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:20px; border:1px dashed #ccc;">
                <label>COLE DADOS DO EXCEL (Matr√≠cula | Nome | Grade | S√©rie)</label>
                <textarea id="txtExcel" style="height:60px; margin:5px 0;" placeholder="Cole as colunas aqui..."></textarea>
                <button class="btn-std btn-verde" onclick="importarExcel()">Processar Lote</button>
            </div>
            <div class="form-row">
                <div style="width:100px;"><label>MATR√çCULA</label><input type="text" id="alMat"></div>
                <div style="flex:1;"><label>NOME</label><input type="text" id="alNome"></div>
                <div style="width:180px;"><label>SALA (GRADE)</label><select id="alGrade"></select></div>
                <div style="width:80px;"><label>S√âRIE</label><select id="alSerie"><option>1¬∫</option><option>2¬∫</option><option>3¬∫</option><option>4¬∫</option><option>5¬∫</option><option>6¬∫</option><option>7¬∫</option><option>8¬∫</option><option>9¬∫</option></select></div>
                <div style="width:130px;"><label>DATA IN√çCIO</label><input type="date" id="alIni"></div>
                <button class="btn-std btn-azul" onclick="salvarAlunoManual()">Adicionar</button>
            </div>
            <div class="table-wrapper"><table><thead><tr><th>MATR√çCULA</th><th>NOME</th><th>GRADE</th><th>S√âRIE</th><th>IN√çCIO</th><th>T√âRMINO</th><th>A√á√ïES</th></tr></thead><tbody id="listaAlunos"></tbody></table></div>
        </div>
    </div>

    <footer>Idealizado por: <b>Allan Ramos | Policial Penal | CPP II de Bauru</b></footer>

    <script>
        const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbw_uZ8-aSjr0zmU5yfynA4He3oZ0E-hluKw1zg-kJCirAmSUN6xMFlOwwOEJVvBECQ2XQ/exec";
        let db = { cursos: [], superior: [], regular: [], alunos: [] };

        async function abrir(id) {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('main-header').style.display = 'none';
            document.querySelectorAll('.content-card').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            await carregarDados();
        }

        function voltarAoMenu() {
            document.querySelectorAll('.content-card').forEach(c => c.classList.remove('active'));
            document.getElementById('main-menu').style.display = 'grid';
            document.getElementById('main-header').style.display = 'block';
        }

        async function carregarDados() {
            document.getElementById('loading').style.display = 'flex';
            try {
                const res = await fetch(URL_SCRIPT);
                const data = await res.json();
                db = { cursos: data.cursos || [], superior: data.superior || [], regular: data.salas || [], alunos: data.alunos || [] };
                atualizarTodasTabelas();
            } catch(e) { console.error(e); }
            document.getElementById('loading').style.display = 'none';
        }

        function atualizarTodasTabelas() {
            renderCursos();
            renderSuperior();
            renderRegular();
        }

        function renderCursos() {
            const tb = document.getElementById('listaCursos'); tb.innerHTML = "";
            db.cursos.forEach((c, i) => {
                tb.innerHTML += `<tr><td>${i+1}</td><td style="text-align:left">${c.nome}${c.concluido?'<span class="badge-conc">CONC</span>':''}</td><td>${c.tipo}</td><td>${c.carga}</td><td>${fmtData(c.inicio)}</td><td>${fmtData(c.termino)}</td><td>${c.part}</td><td>${c.conc||0}</td><td><button onclick="abrirEdicao('cursos',${i})" style="color:orange;border:none;background:none;cursor:pointer"><i class="fa fa-edit"></i></button></td></tr>`;
            });
        }

        function renderSuperior() {
            const tb = document.getElementById('listaSuperior'); tb.innerHTML = "";
            db.superior.forEach((c, i) => {
                tb.innerHTML += `<tr><td>${i+1}</td><td style="text-align:left">${c.nome}</td><td>${c.grau}</td><td>${c.inst}</td><td>${c.per}</td><td>${c.sala}</td><td>${c.alunos}</td><td>${fmtData(c.inicio)}</td><td>${fmtData(c.termino)}</td><td><button onclick="abrirEdicao('superior',${i})" style="color:orange;border:none;background:none;cursor:pointer"><i class="fa fa-edit"></i></button></td></tr>`;
            });
        }

        function renderRegular() {
            const tb = document.getElementById('listaSalas'); tb.innerHTML = "";
            db.regular.forEach((s, i) => {
                const total = db.alunos.filter(a => a.grade === s.grade).length;
                tb.innerHTML += `<tr><td style="text-align:left"><b>${s.grade}</b></td><td>${s.tipo}</td><td>${s.per}</td><td>${s.sem}</td><td>${s.sala}</td><td>${total}</td><td>0</td><td>0</td><td><button onclick="abrirEdicao('regular',${i})" style="color:orange;border:none;background:none;cursor:pointer"><i class="fa fa-edit"></i></button></td></tr>`;
            });
        }

        async function salvarNovo(tipo) {
            let item = {};
            if(tipo === 'cursos') item = { nome: val('curNome').toUpperCase(), tipo: val('curTipo'), carga: val('curCarga'), inicio: val('curIni'), part: val('curPart'), termino:"", conc:"", concluido: false };
            if(tipo === 'superior') item = { nome: val('supNome').toUpperCase(), grau: val('supGrau'), inst: val('supInst').toUpperCase(), per: val('supPer'), sala: val('supSala'), alunos: val('supAlunos'), inicio: val('supIni'), termino:"" };
            if(tipo === 'regular') item = { grade: val('regGrade').toUpperCase(), tipo: val('regTipo'), per: val('regPer'), sem: val('regSem'), sala: val('regSala'), inicio: val('regIni'), termino: val('regFim') };
            
            db[tipo==='regular'?'regular':tipo].push(item);
            await sincronizar();
        }

        function abrirGestaoAlunos() {
            const sel = document.getElementById('alGrade');
            sel.innerHTML = db.regular.map(s => `<option>${s.grade}</option>`).join('');
            renderAlunos();
            document.getElementById('modalGestaoAlunos').style.display = 'flex';
        }

        function fecharGestaoAlunos() { document.getElementById('modalGestaoAlunos').style.display = 'none'; renderRegular(); }

        function renderAlunos() {
            const tb = document.getElementById('listaAlunos'); tb.innerHTML = "";
            db.alunos.forEach((a, i) => {
                tb.innerHTML += `<tr><td>${a.matricula}</td><td style="text-align:left">${a.nome}</td><td>${a.grade}</td><td>${a.serie}</td><td>${fmtData(a.inicio)}</td><td>${fmtData(a.termino)}</td><td><button onclick="removerAluno(${i})" style="color:red;border:none;background:none;cursor:pointer"><i class="fa fa-trash"></i></button></td></tr>`;
            });
        }

        function importarExcel() {
            const txt = document.getElementById('txtExcel').value;
            const linhas = txt.split('\n');
            linhas.forEach(l => {
                const c = l.split('\t');
                if(c.length >= 4) db.alunos.push({ matricula: c[0].trim(), nome: c[1].trim().toUpperCase(), grade: c[2].trim().toUpperCase(), serie: c[3].trim(), inicio: "", termino: "" });
            });
            renderAlunos();
            document.getElementById('txtExcel').value = "";
        }

        async function salvarAlunoManual() {
            db.alunos.push({ matricula: val('alMat'), nome: val('alNome').toUpperCase(), grade: val('alGrade'), serie: val('alSerie'), inicio: val('alIni'), termino: "" });
            renderAlunos();
            await sincronizar();
        }

        async function sincronizar() {
            document.getElementById('loading').style.display = 'flex';
            const payload = { acao: 'salvarTudo', cursos: db.cursos, superior: db.superior, salas: db.regular, alunos: db.alunos };
            await fetch(URL_SCRIPT, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            await carregarDados();
        }

        function fmtData(d) { if(!d) return "---"; return d.split('T')[0].split('-').reverse().join('/'); }
        function val(id) { return document.getElementById(id).value; }
        function fecharModal() { document.getElementById('modalGeral').style.display='none'; }
    </script>
</body>
</html>
