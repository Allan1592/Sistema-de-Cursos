<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Ensino - CPP II Bauru</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --verde: #2d9344; --laranja: #e67e22; --azul: #3498db; --roxo: #8b5cf6;
            --vermelho: #d32f2f; --cinza-claro: #f4f7f6; --dark: #2c3e50;
            --rosa-claro: #ffe4e1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--cinza-claro); display: flex; flex-direction: column; min-height: 100vh; }

        #main-header { text-align: center; padding: 25px 10px; }
        h2 { color: var(--dark); font-size: 1.8rem; text-transform: uppercase; }
        .subtitle { color: #666; font-size: 0.9rem; font-weight: 500; }

        #main-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; width: 90%; max-width: 800px; margin: 20px auto; }
        .card-btn { height: 140px; border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.3s; }
        .card-btn i { font-size: 2.5rem; margin-bottom: 12px; }
        .card-btn:hover { transform: translateY(-5px); filter: brightness(1.1); }

        .btn-verde { background: var(--verde); }
        .btn-azul { background: var(--azul); }

        .content-card { width: 95%; max-width: 1200px; background: white; border-radius: 12px; padding: 25px; display: none; box-shadow: 0 8px 20px rgba(0,0,0,0.1); margin: 20px auto; }
        .active { display: block; }
        .btn-voltar { background: #666; color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }

        .form-row { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: flex-end; }
        label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: var(--dark); }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; }
        
        .btn-std { padding: 10px 20px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f8f9fa; padding: 12px; border-bottom: 2px solid #dee2e6; font-size: 0.85rem; text-align: center; }
        td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; font-size: 0.9rem; }

        .linha-concluido { background-color: var(--rosa-claro) !important; }

        #loading { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:5000; justify-content:center; align-items:center; flex-direction:column; }
        
        #modalGeral { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 450px; }
    </style>
</head>
<body>

    <div id="loading"><i class="fa fa-spinner fa-spin fa-2x"></i><p style="margin-top:10px; font-weight:bold;">PROCESSANDO...</p></div>

    <div id="main-header">
        <h2>Gestão de Ensino</h2>
        <div class="subtitle">CPP II "Dr. Eduardo de Oliveira Vianna" de Bauru</div>
    </div>

    <div id="main-menu">
        <button class="card-btn btn-verde" onclick="abrir('cursos')"><i class="fa fa-book-open"></i>Cursos</button>
        <button class="card-btn btn-azul" onclick="abrir('superior')"><i class="fa fa-graduation-cap"></i>Ensino Superior</button>
    </div>

    <div id="cursos" class="content-card">
        <button class="btn-voltar" onclick="voltarMenu()">Voltar ao Menu</button>
        <h3 style="color:var(--verde); margin-bottom:15px;">Cursos Profissionalizantes</h3>
        <div class="form-row">
            <div style="flex:2;"><label>Nome do Curso</label><input type="text" id="curNome"></div>
            <div style="width:150px;"><label>Data Início</label><input type="date" id="curIni"></div>
            <div style="width:100px;"><label>Participantes</label><input type="number" id="curPart"></div>
            <button class="btn-std btn-verde" onclick="salvarNovo('cursos')">Salvar</button>
        </div>
        <div style="overflow-x:auto;">
            <table><thead><tr><th>Curso</th><th>Início</th><th>Término</th><th>Part.</th><th>Conc.</th><th>Ações</th></tr></thead><tbody id="listaCursos"></tbody></table>
        </div>
    </div>

    <div id="superior" class="content-card">
        <button class="btn-voltar" onclick="voltarMenu()">Voltar ao Menu</button>
        <h3 style="color:var(--azul); margin-bottom:15px;">Ensino Superior</h3>
        <div class="form-row">
            <div style="flex:2;"><label>Nome do Curso</label><input type="text" id="supNome"></div>
            <div style="width:150px;"><label>Instituição</label><input type="text" id="supInst"></div>
            <div style="width:150px;"><label>Data Início</label><input type="date" id="supIni"></div>
            <button class="btn-std btn-azul" onclick="salvarNovo('superior')">Salvar</button>
        </div>
        <div style="overflow-x:auto;">
            <table><thead><tr><th>Curso</th><th>Instituição</th><th>Início</th><th>Término</th><th>Ações</th></tr></thead><tbody id="listaSuperior"></tbody></table>
        </div>
    </div>

    <div id="modalGeral">
        <div class="modal-content">
            <h3 id="mTit" style="margin-bottom:20px; border-bottom:2px solid #333;">Editar Registro</h3>
            <div id="mCampos" style="display:flex; flex-direction:column; gap:15px;"></div>
            <div style="display:flex; gap:10px; margin-top:25px;">
                <button class="btn-std btn-verde" style="flex:1" onclick="confirmarEdicao()">Confirmar</button>
                <button class="btn-std" style="flex:1; background:#666" onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbw_uZ8-aSjr0zmU5yfynA4He3oZ0E-hluKw1zg-kJCirAmSUN6xMFlOwwOEJVvBECQ2XQ/exec";
        let db = { cursos: [], superior: [] };
        let editandoIndex = -1;
        let editandoTipo = "";

        async function carregarDados() {
            document.getElementById('loading').style.display = 'flex';
            try {
                const res = await fetch(URL_SCRIPT);
                const data = await res.json();
                db.cursos = data.cursos || [];
                db.superior = data.superior || [];
                renderCursos();
                renderSuperior();
            } catch (e) { alert("Erro ao carregar dados!"); }
            document.getElementById('loading').style.display = 'none';
        }

        function renderCursos() {
            const tb = document.getElementById('listaCursos'); tb.innerHTML = "";
            db.cursos.forEach((c, i) => {
                const trClass = (c.status === "SIM") ? 'class="linha-concluido"' : '';
                tb.innerHTML += `<tr ${trClass}><td>${c.curso}</td><td>${fmtD(c.início)}</td><td>${fmtD(c.término)}</td><td>${c.participantes}</td><td>${c.concluintes}</td>
                <td><button onclick="abrirEdicao('cursos', ${i})">✏️</button></td></tr>`;
            });
        }

        function renderSuperior() {
            const tb = document.getElementById('listaSuperior'); tb.innerHTML = "";
            db.superior.forEach((s, i) => {
                tb.innerHTML += `<tr><td>${s.curso}</td><td>${s.instituição}</td><td>${fmtD(s.início)}</td><td>${fmtD(s.término)}</td>
                <td><button onclick="abrirEdicao('superior', ${i})">✏️</button></td></tr>`;
            });
        }

        async function salvarNovo(tipo) {
            document.getElementById('loading').style.display = 'flex';
            let item = {};
            if(tipo === 'cursos') {
                item = { acao: 'salvarCurso', curso: val('curNome'), inicio: val('curIni'), part: val('curPart') };
            } else {
                item = { acao: 'salvarSuperior', curso: val('supNome'), inst: val('supInst'), inicio: val('supIni') };
            }
            await fetch(URL_SCRIPT, { method: 'POST', mode: 'no-cors', body: JSON.stringify(item) });
            await carregarDados();
        }

        function abrirEdicao(tipo, idx) {
            editandoTipo = tipo; editandoIndex = idx;
            const item = db[tipo][idx];
            const campos = document.getElementById('mCampos');
            campos.innerHTML = "";

            if(tipo === 'cursos') {
                campos.innerHTML = `<label>Nome do Curso</label><input type="text" id="edNome" value="${item.curso}">
                <label>Status Concluído (SIM/NÃO)</label><input type="text" id="edStatus" value="${item.status || 'NÃO'}">
                <label>Data Término</label><input type="date" id="edFim" value="${item.término ? item.término.split('T')[0] : ''}">
                <label>Concluintes</label><input type="number" id="edConc" value="${item.concluintes || 0}">`;
            } else {
                campos.innerHTML = `<label>Curso</label><input type="text" id="edSupNome" value="${item.curso}">
                <label>Instituição</label><input type="text" id="edSupInst" value="${item.instituição}">
                <label>Data Início</label><input type="date" id="edSupIni" value="${item.início ? item.início.split('T')[0] : ''}">`;
            }
            document.getElementById('modalGeral').style.display = 'flex';
        }

        async function confirmarEdicao() {
            document.getElementById('loading').style.display = 'flex';
            let payload = { acao: 'editarGeral', tipo: editandoTipo, index: editandoIndex };
            
            if(editandoTipo === 'cursos') {
                payload.curso = val('edNome'); payload.status = val('edStatus').toUpperCase();
                payload.termino = val('edFim'); payload.concluintes = val('edConc');
            } else {
                payload.curso = val('edSupNome'); payload.inst = val('edSupInst'); payload.inicio = val('edSupIni');
            }

            await fetch(URL_SCRIPT, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            fecharModal();
            await carregarDados();
        }

        function abrir(id) {
            document.getElementById('main-menu').style.display = 'none';
            document.querySelectorAll('.content-card').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            carregarDados();
        }

        function voltarMenu() {
            document.querySelectorAll('.content-card').forEach(c => c.classList.remove('active'));
            document.getElementById('main-menu').style.display = 'grid';
        }

        function val(id) { return document.getElementById(id).value; }
        function fecharModal() { document.getElementById('modalGeral').style.display = 'none'; }
        function fmtD(d) { if(!d) return "---"; return d.split('T')[0].split('-').reverse().join('/'); }
    </script>
</body>
</html>
